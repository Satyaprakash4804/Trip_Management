<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Details</title>

<style>
/* Simple UI â€“ clean table only */
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    margin:20px;
}

h2{
    color:#1a237e;
    margin-bottom:15px;
}

.table-container{
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 20px rgba(0,0,0,0.08);
}

.search-box{
    margin-bottom:15px;
}

.search-box input{
    width:100%;
    padding:10px;
    border:1px solid #aaa;
    border-radius:8px;
}

/* Table */
table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th{
    background:#1a237e;
    color:white;
    padding:12px;
}

td{
    padding:10px;
    border-bottom:1px solid #ddd;
    background:white;
}

.selfie-img{
    width:50px;height:50px;
    object-fit:cover;
    border-radius:6px;
}

.verified{
    padding:4px 10px;
    background:#4caf50;
    color:white;
    border-radius:15px;
    font-size:12px;
}
.pending{
    padding:4px 10px;
    background:#ffa000;
    color:white;
    border-radius:15px;
    font-size:12px;
}

.btn-edit{
    background:#0277bd;
    color:white;
    padding:5px 10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.btn-del{
    background:#d32f2f;
    color:white;
    padding:5px 10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
}

/* Modal */
.modal-bg{
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.5);
    display:none;
    align-items:center;justify-content:center;
}
.modal-card{
    background:white;
    padding:20px;
    width:90%;max-width:400px;
    border-radius:10px;
}
.modal-card input{
    width:100%;padding:10px;margin-bottom:10px;
    border:1px solid #ccc;border-radius:6px;
}
</style>

</head>
<body>

<h2>Admin Details</h2>

<div class="table-container">

    <div class="search-box">
        <input id="search" placeholder="Search admin..." onkeyup="filterTable()">
    </div>

    <table id="adminsTable">
        <thead>
            <tr>
                <th>Username</th>
                <th>Name</th>
                <th>Mobile</th>
                <th>Email</th>
                <th>College ID</th>
                <th>Selfie</th>
                <th>Status</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

</div>

<!-- EDIT MODAL -->
<div id="modal" class="modal-bg">
    <div class="modal-card">
        <h3>Edit Admin</h3>

        <input id="edit_name" placeholder="Full Name">
        <input id="edit_mobile" placeholder="Mobile">
        <input id="edit_email" placeholder="Email">
        <input id="edit_college_id" placeholder="College ID">

        <button class="btn-edit" onclick="updateAdmin()">Save</button>
        <button class="btn-del" onclick="closeModal()">Cancel</button>
    </div>
</div>

<script>
let selectedID = null;

// Load Admin List
function loadAdmins(){
    fetch("/api/master/admins")
    .then(r=>r.json())
    .then(res=>{
        let tb=document.getElementById("tbody");
        tb.innerHTML="";

        res.data.forEach(row=>{
            let selfie = row.selfie
                ? `<img src="/${row.selfie}" class="selfie-img">`
                : `<span style='color:#777;'>No image</span>`;

            tb.innerHTML += `
                <tr>
                    <td>${row.username}</td>
                    <td>${row.name || "-"}</td>
                    <td>${row.mobile || "-"}</td>
                    <td>${row.email || "-"}</td>
                    <td>${row.college_id || "-"}</td>
                    <td>${selfie}</td>
                    <td>${row.is_verified ? 
                        "<span class='verified'>Verified</span>" :
                        "<span class='pending'>Pending</span>" }
                    </td>
                    <td>
                        <button class="btn-edit" onclick="openEdit(${row.id}, '${row.name}', '${row.mobile}', '${row.email}', '${row.college_id}')">
                            Edit
                        </button>
                    </td>
                    <td>
                        <button class="btn-del" onclick="deleteAdmin(${row.id})">Delete</button>
                    </td>
                </tr>
            `;
        });
    });
}
loadAdmins();

// Search
function filterTable(){
    let val = search.value.toLowerCase();
    let rows = document.querySelectorAll("#adminsTable tbody tr");

    rows.forEach(r=>{
        r.style.display = r.innerText.toLowerCase().includes(val) ? "" : "none";
    });
}

// Modal
function openEdit(id,name,mobile,email,college){
    selectedID = id;
    edit_name.value = name;
    edit_mobile.value = mobile;
    edit_email.value = email;
    edit_college_id.value = college;
    modal.style.display="flex";
}
function closeModal(){
    modal.style.display="none";
}

// Update
function updateAdmin(){
    let data={
        name: edit_name.value,
        mobile: edit_mobile.value,
        email: edit_email.value,
        college_id: edit_college_id.value
    };

    fetch(`/api/master/update_user/${selectedID}`,{
        method:"PUT",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(data)
    })
    .then(r=>r.json())
    .then(d=>{
        alert(d.message);
        closeModal();
        loadAdmins();
    });
}

// Delete
function deleteAdmin(id){
    if(!confirm("Delete this admin?")) return;

    fetch(`/api/master/delete/${id}`,{method:"DELETE"})
    .then(r=>r.json())
    .then(res=>{
        alert(res.message);
        loadAdmins();
    });
}
</script>

</body>
</html>
